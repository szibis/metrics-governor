<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 520" width="1100" height="520">
  <style>
    .bg { fill: #ffffff; }
    .title { fill: #1e1b4b; font: bold 22px 'Segoe UI', system-ui, sans-serif; }
    .subtitle { fill: #6b7280; font: 14px 'Segoe UI', system-ui, sans-serif; }
    .box-label { fill: #1e293b; font: bold 13px 'Segoe UI', system-ui, sans-serif; }
    .box-sub { fill: #64748b; font: 11px 'Segoe UI', system-ui, sans-serif; }
    .section-label { fill: #4338ca; font: bold 11px 'Segoe UI', system-ui, sans-serif; letter-spacing: 0.5px; }
    .badge-text { fill: #ffffff; font: bold 10px 'Segoe UI', system-ui, sans-serif; }
    .badge-text-dark { fill: #1e293b; font: bold 10px 'Segoe UI', system-ui, sans-serif; }
    .arrow-line { stroke: #94a3b8; stroke-width: 2; fill: none; }
    .arrow-line-otlp { stroke: #0891b2; stroke-width: 2.5; fill: none; }
    .arrow-line-prw { stroke: #059669; stroke-width: 2.5; fill: none; }
    .arrow-head { fill: #94a3b8; }
    .arrow-head-otlp { fill: #0891b2; }
    .arrow-head-prw { fill: #059669; }
    .dashed { stroke-dasharray: 6,4; }
    .backpressure { stroke: #dc2626; stroke-width: 1.5; fill: none; stroke-dasharray: 4,3; }
    .bp-head { fill: #dc2626; }
    .bp-label { fill: #dc2626; font: bold 9px 'Segoe UI', system-ui, sans-serif; }
    .pipe-label { font: bold 10px 'Segoe UI', system-ui, sans-serif; }
    .otlp-label { fill: #0891b2; }
    .prw-label { fill: #059669; }
    .governor-border { stroke: #4f46e5; stroke-width: 2; fill: none; rx: 16; ry: 16; }
    .governor-bg { fill: #f5f3ff; rx: 16; ry: 16; }

    @media (prefers-color-scheme: dark) {
      .bg { fill: #0f172a; }
      .title { fill: #e2e8f0; }
      .subtitle { fill: #94a3b8; }
      .box-label { fill: #e2e8f0; }
      .box-sub { fill: #94a3b8; }
      .section-label { fill: #a5b4fc; }
      .arrow-line { stroke: #475569; }
      .arrow-head { fill: #475569; }
      .governor-bg { fill: #1e1b4b; opacity: 0.4; }
      .governor-border { stroke: #6366f1; }
      .badge-text-dark { fill: #e2e8f0; }
      .bp-label { fill: #f87171; }
      .backpressure { stroke: #f87171; }
      .bp-head { fill: #f87171; }
    }
  </style>

  <defs>
    <!-- Gradients -->
    <linearGradient id="grad-indigo" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#4f46e5"/>
      <stop offset="100%" stop-color="#7c3aed"/>
    </linearGradient>
    <linearGradient id="grad-cyan" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#0891b2"/>
      <stop offset="100%" stop-color="#06b6d4"/>
    </linearGradient>
    <linearGradient id="grad-green" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#059669"/>
      <stop offset="100%" stop-color="#10b981"/>
    </linearGradient>
    <linearGradient id="grad-amber" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#d97706"/>
      <stop offset="100%" stop-color="#f59e0b"/>
    </linearGradient>
    <linearGradient id="grad-rose" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#e11d48"/>
      <stop offset="100%" stop-color="#f43f5e"/>
    </linearGradient>
    <linearGradient id="grad-slate" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#334155"/>
      <stop offset="100%" stop-color="#475569"/>
    </linearGradient>
    <linearGradient id="grad-sky" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#0284c7"/>
      <stop offset="100%" stop-color="#38bdf8"/>
    </linearGradient>

    <!-- Drop shadow -->
    <filter id="shadow" x="-4%" y="-4%" width="108%" height="112%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#000" flood-opacity="0.12"/>
    </filter>
    <filter id="shadow-sm" x="-2%" y="-2%" width="104%" height="108%">
      <feDropShadow dx="0" dy="1" stdDeviation="1.5" flood-color="#000" flood-opacity="0.1"/>
    </filter>

    <!-- Arrowhead markers -->
    <marker id="ah" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="8" markerHeight="6" orient="auto">
      <path d="M0,0 L10,3 L0,6 Z" class="arrow-head"/>
    </marker>
    <marker id="ah-otlp" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="8" markerHeight="6" orient="auto">
      <path d="M0,0 L10,3 L0,6 Z" class="arrow-head-otlp"/>
    </marker>
    <marker id="ah-prw" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="8" markerHeight="6" orient="auto">
      <path d="M0,0 L10,3 L0,6 Z" class="arrow-head-prw"/>
    </marker>
    <marker id="ah-bp" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="8" markerHeight="6" orient="auto">
      <path d="M0,0 L10,3 L0,6 Z" class="bp-head"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1100" height="520" class="bg"/>

  <!-- ═══════════════════ SOURCES COLUMN (x=30) ═══════════════════ -->
  <text x="85" y="100" text-anchor="middle" class="section-label">SOURCES</text>

  <!-- OpenTelemetry Apps -->
  <rect x="20" y="115" width="130" height="70" rx="10" fill="url(#grad-cyan)" filter="url(#shadow)"/>
  <text x="85" y="147" text-anchor="middle" class="badge-text" style="font-size:12px">OpenTelemetry</text>
  <text x="85" y="165" text-anchor="middle" class="badge-text" style="font-size:11px;opacity:0.85">Apps &amp; Services</text>

  <!-- Prometheus Servers -->
  <rect x="20" y="335" width="130" height="70" rx="10" fill="url(#grad-green)" filter="url(#shadow)"/>
  <text x="85" y="367" text-anchor="middle" class="badge-text" style="font-size:12px">Prometheus</text>
  <text x="85" y="385" text-anchor="middle" class="badge-text" style="font-size:11px;opacity:0.85">Remote Write</text>

  <!-- ═══════════════════ METRICS-GOVERNOR (x=200..830) ═══════════════════ -->
  <rect x="195" y="55" width="650" height="420" class="governor-bg"/>
  <rect x="195" y="55" width="650" height="420" class="governor-border"/>

  <!-- Title bar -->
  <text x="520" y="84" text-anchor="middle" class="title">metrics-governor</text>

  <!-- ─── OTLP Pipeline Lane (y=105..230) ─── -->
  <text x="215" y="118" class="pipe-label otlp-label">OTLP PIPELINE</text>

  <!-- Receiver -->
  <rect x="215" y="128" width="90" height="55" rx="8" fill="url(#grad-cyan)" filter="url(#shadow-sm)"/>
  <text x="260" y="152" text-anchor="middle" class="badge-text" style="font-size:11px">Receiver</text>
  <text x="260" y="168" text-anchor="middle" class="badge-text" style="font-size:9px;opacity:0.8">gRPC / HTTP</text>

  <!-- Stats + Limits -->
  <rect x="325" y="128" width="90" height="55" rx="8" fill="url(#grad-indigo)" filter="url(#shadow-sm)"/>
  <text x="370" y="152" text-anchor="middle" class="badge-text" style="font-size:11px">Stats</text>
  <text x="370" y="168" text-anchor="middle" class="badge-text" style="font-size:9px;opacity:0.8">Limits</text>

  <!-- Buffer -->
  <rect x="435" y="128" width="90" height="55" rx="8" fill="url(#grad-amber)" filter="url(#shadow-sm)"/>
  <text x="480" y="152" text-anchor="middle" class="badge-text" style="font-size:11px">Buffer</text>
  <text x="480" y="168" text-anchor="middle" class="badge-text" style="font-size:9px;opacity:0.8">Bounded</text>

  <!-- Queue -->
  <rect x="545" y="128" width="90" height="55" rx="8" fill="url(#grad-slate)" filter="url(#shadow-sm)"/>
  <text x="590" y="148" text-anchor="middle" class="badge-text" style="font-size:11px">Queue</text>
  <text x="590" y="163" text-anchor="middle" class="badge-text" style="font-size:9px;opacity:0.8">Always-Queue</text>
  <text x="590" y="176" text-anchor="middle" class="badge-text" style="font-size:8px;opacity:0.7">Disk Persistent</text>

  <!-- Workers -->
  <rect x="655" y="128" width="90" height="55" rx="8" fill="url(#grad-sky)" filter="url(#shadow-sm)"/>
  <text x="700" y="148" text-anchor="middle" class="badge-text" style="font-size:11px">Workers</text>
  <text x="700" y="163" text-anchor="middle" class="badge-text" style="font-size:9px;opacity:0.8">2 x NumCPU</text>
  <text x="700" y="176" text-anchor="middle" class="badge-text" style="font-size:8px;opacity:0.7">Pull Model</text>

  <!-- Export -->
  <rect x="765" y="128" width="60" height="55" rx="8" fill="url(#grad-indigo)" filter="url(#shadow-sm)"/>
  <text x="795" y="152" text-anchor="middle" class="badge-text" style="font-size:11px">Export</text>
  <text x="795" y="168" text-anchor="middle" class="badge-text" style="font-size:9px;opacity:0.8">OTLP</text>

  <!-- OTLP pipeline arrows -->
  <line x1="305" y1="155" x2="323" y2="155" class="arrow-line-otlp" marker-end="url(#ah-otlp)"/>
  <line x1="415" y1="155" x2="433" y2="155" class="arrow-line-otlp" marker-end="url(#ah-otlp)"/>
  <line x1="525" y1="155" x2="543" y2="155" class="arrow-line-otlp" marker-end="url(#ah-otlp)"/>
  <line x1="635" y1="155" x2="653" y2="155" class="arrow-line-otlp" marker-end="url(#ah-otlp)"/>
  <line x1="745" y1="155" x2="763" y2="155" class="arrow-line-otlp" marker-end="url(#ah-otlp)"/>

  <!-- ─── PRW Pipeline Lane (y=290..410) ─── -->
  <text x="215" y="308" class="pipe-label prw-label">PRW PIPELINE</text>

  <!-- Receiver -->
  <rect x="215" y="318" width="90" height="55" rx="8" fill="url(#grad-green)" filter="url(#shadow-sm)"/>
  <text x="260" y="342" text-anchor="middle" class="badge-text" style="font-size:11px">Receiver</text>
  <text x="260" y="358" text-anchor="middle" class="badge-text" style="font-size:9px;opacity:0.8">HTTP</text>

  <!-- Stats + Limits -->
  <rect x="325" y="318" width="90" height="55" rx="8" fill="url(#grad-indigo)" filter="url(#shadow-sm)"/>
  <text x="370" y="342" text-anchor="middle" class="badge-text" style="font-size:11px">Stats</text>
  <text x="370" y="358" text-anchor="middle" class="badge-text" style="font-size:9px;opacity:0.8">Limits</text>

  <!-- Queue -->
  <rect x="475" y="318" width="90" height="55" rx="8" fill="url(#grad-slate)" filter="url(#shadow-sm)"/>
  <text x="520" y="338" text-anchor="middle" class="badge-text" style="font-size:11px">Queue</text>
  <text x="520" y="353" text-anchor="middle" class="badge-text" style="font-size:9px;opacity:0.8">Always-Queue</text>
  <text x="520" y="366" text-anchor="middle" class="badge-text" style="font-size:8px;opacity:0.7">Disk Persistent</text>

  <!-- Workers -->
  <rect x="585" y="318" width="90" height="55" rx="8" fill="url(#grad-sky)" filter="url(#shadow-sm)"/>
  <text x="630" y="338" text-anchor="middle" class="badge-text" style="font-size:11px">Workers</text>
  <text x="630" y="353" text-anchor="middle" class="badge-text" style="font-size:9px;opacity:0.8">2 x NumCPU</text>
  <text x="630" y="366" text-anchor="middle" class="badge-text" style="font-size:8px;opacity:0.7">Pull Model</text>

  <!-- Export -->
  <rect x="695" y="318" width="60" height="55" rx="8" fill="url(#grad-indigo)" filter="url(#shadow-sm)"/>
  <text x="725" y="342" text-anchor="middle" class="badge-text" style="font-size:11px">Export</text>
  <text x="725" y="358" text-anchor="middle" class="badge-text" style="font-size:9px;opacity:0.8">PRW</text>

  <!-- PRW pipeline arrows -->
  <line x1="305" y1="345" x2="323" y2="345" class="arrow-line-prw" marker-end="url(#ah-prw)"/>
  <line x1="415" y1="345" x2="473" y2="345" class="arrow-line-prw" marker-end="url(#ah-prw)"/>
  <line x1="565" y1="345" x2="583" y2="345" class="arrow-line-prw" marker-end="url(#ah-prw)"/>
  <line x1="675" y1="345" x2="693" y2="345" class="arrow-line-prw" marker-end="url(#ah-prw)"/>

  <!-- ─── Circuit Breaker (shared concept, center) ─── -->
  <rect x="445" y="215" width="165" height="55" rx="10" fill="none" stroke="url(#grad-rose)" stroke-width="2" stroke-dasharray="6,3"/>
  <text x="528" y="239" text-anchor="middle" class="box-label" style="font-size:11px">Circuit Breaker Gate</text>
  <text x="528" y="256" text-anchor="middle" class="box-sub" style="font-size:9px">CAS half-open + backoff</text>

  <!-- CB arrows from workers -->
  <path d="M700,183 L700,200 Q700,210 690,215 L612,215" class="backpressure" style="stroke:#e11d48;stroke-dasharray:5,3"/>
  <path d="M630,318 L630,300 Q630,280 620,272 L612,270" class="backpressure" style="stroke:#e11d48;stroke-dasharray:5,3"/>

  <!-- Retry arrows from workers back to queue -->
  <path d="M660,183 L660,200 L595,200 L595,183" class="arrow-line" style="stroke:#94a3b8;stroke-dasharray:4,3" marker-end="url(#ah)"/>
  <text x="628" y="197" text-anchor="middle" class="box-sub" style="font-size:8px">retry</text>

  <path d="M590,373 L590,393 L525,393 L525,373" class="arrow-line" style="stroke:#94a3b8;stroke-dasharray:4,3" marker-end="url(#ah)"/>
  <text x="558" y="388" text-anchor="middle" class="box-sub" style="font-size:8px">retry</text>

  <!-- ─── Backpressure arrow (buffer -> receiver) ─── -->
  <path d="M480,183 C480,203 260,203 260,183" class="backpressure" marker-end="url(#ah-bp)"/>
  <text x="370" y="212" text-anchor="middle" class="bp-label">429 / ResourceExhausted</text>

  <!-- ─── Feature Badges (bottom strip) ─── -->
  <rect x="210" y="435" width="78" height="22" rx="11" fill="url(#grad-indigo)" filter="url(#shadow-sm)"/>
  <text x="249" y="450" text-anchor="middle" class="badge-text" style="font-size:9px">Adaptive Limits</text>

  <rect x="296" y="435" width="78" height="22" rx="11" fill="url(#grad-cyan)" filter="url(#shadow-sm)"/>
  <text x="335" y="450" text-anchor="middle" class="badge-text" style="font-size:9px">TLS / mTLS</text>

  <rect x="382" y="435" width="60" height="22" rx="11" fill="url(#grad-green)" filter="url(#shadow-sm)"/>
  <text x="412" y="450" text-anchor="middle" class="badge-text" style="font-size:9px">Sharding</text>

  <rect x="450" y="435" width="78" height="22" rx="11" fill="url(#grad-amber)" filter="url(#shadow-sm)"/>
  <text x="489" y="450" text-anchor="middle" class="badge-text" style="font-size:9px">Split-on-Error</text>

  <rect x="536" y="435" width="85" height="22" rx="11" fill="url(#grad-rose)" filter="url(#shadow-sm)"/>
  <text x="579" y="450" text-anchor="middle" class="badge-text" style="font-size:9px">Circuit Breaker</text>

  <rect x="629" y="435" width="62" height="22" rx="11" fill="url(#grad-sky)" filter="url(#shadow-sm)"/>
  <text x="660" y="450" text-anchor="middle" class="badge-text" style="font-size:9px">Helm Chart</text>

  <rect x="699" y="435" width="88" height="22" rx="11" fill="url(#grad-slate)" filter="url(#shadow-sm)"/>
  <text x="743" y="450" text-anchor="middle" class="badge-text" style="font-size:9px">Memory Sizing %</text>

  <!-- ═══════════════════ BACKENDS COLUMN (x=880) ═══════════════════ -->
  <text x="975" y="100" text-anchor="middle" class="section-label">BACKENDS</text>

  <!-- OTLP Backends -->
  <rect x="895" y="115" width="160" height="85" rx="10" fill="url(#grad-cyan)" filter="url(#shadow)"/>
  <text x="975" y="141" text-anchor="middle" class="badge-text" style="font-size:12px">OTLP Backends</text>
  <text x="975" y="160" text-anchor="middle" class="badge-text" style="font-size:10px;opacity:0.85">OTel Collector</text>
  <text x="975" y="176" text-anchor="middle" class="badge-text" style="font-size:10px;opacity:0.85">Mimir / VictoriaMetrics</text>

  <!-- PRW Backends -->
  <rect x="895" y="325" width="160" height="85" rx="10" fill="url(#grad-green)" filter="url(#shadow)"/>
  <text x="975" y="351" text-anchor="middle" class="badge-text" style="font-size:12px">PRW Backends</text>
  <text x="975" y="370" text-anchor="middle" class="badge-text" style="font-size:10px;opacity:0.85">Prometheus / Thanos</text>
  <text x="975" y="386" text-anchor="middle" class="badge-text" style="font-size:10px;opacity:0.85">Cortex / VictoriaMetrics</text>

  <!-- ═══════════════════ CONNECTION ARROWS ═══════════════════ -->
  <!-- Sources -> Receivers -->
  <line x1="150" y1="150" x2="213" y2="150" class="arrow-line-otlp" marker-end="url(#ah-otlp)"/>
  <text x="180" y="142" text-anchor="middle" class="pipe-label otlp-label" style="font-size:9px">OTLP</text>

  <line x1="150" y1="365" x2="213" y2="345" class="arrow-line-prw" marker-end="url(#ah-prw)"/>
  <text x="180" y="362" text-anchor="middle" class="pipe-label prw-label" style="font-size:9px">PRW</text>

  <!-- Exporters -> Backends -->
  <line x1="825" y1="155" x2="893" y2="155" class="arrow-line-otlp" marker-end="url(#ah-otlp)"/>
  <line x1="755" y1="345" x2="893" y2="365" class="arrow-line-prw" marker-end="url(#ah-prw)"/>

  <!-- ═══════════════════ METRICS / OBSERVABILITY ═══════════════════ -->
  <rect x="880" y="238" width="175" height="55" rx="10" fill="none" stroke="#4f46e5" stroke-width="1.5" stroke-dasharray="4,3"/>
  <text x="968" y="259" text-anchor="middle" class="section-label" style="font-size:10px">SELF-MONITORING</text>
  <text x="968" y="275" text-anchor="middle" class="box-sub" style="font-size:9px">Prometheus /metrics :9090</text>

  <!-- Subtitle -->
  <text x="550" y="505" text-anchor="middle" class="subtitle">Intelligent metrics proxy with dual OTLP + PRW pipelines, always-queue architecture, and production resilience</text>
</svg>
